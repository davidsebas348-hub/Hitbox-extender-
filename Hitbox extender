-- ===============================
-- HITBOX ORIGINAL (SIN CAMBIAR GUI)
-- OPTIMIZADO PARA LOADSTRING
-- ===============================

if _G.HitboxLoaded then return end
_G.HitboxLoaded = true

repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

repeat task.wait() until Players.LocalPlayer
local LocalPlayer = Players.LocalPlayer

local HitboxEnabled = false
local HitboxSize = 10
local HitboxTransparency = 0.8
local IsMinimized = false

local OriginalData = {}

-- GUI (NO MODIFICADO)
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local MainFrameCorner = Instance.new("UICorner")
local SizeInput = Instance.new("TextBox")
local SizeInputCorner = Instance.new("UICorner")
local TransparencyInput = Instance.new("TextBox")
local TransparencyInputCorner = Instance.new("UICorner")
local EnableButton = Instance.new("TextButton")
local EnableButtonCorner = Instance.new("UICorner")
local MinimizeButton = Instance.new("TextButton")
local MinimizeButtonCorner = Instance.new("UICorner")

ScreenGui.Parent = game.CoreGui

MainFrame.Parent = ScreenGui
MainFrame.Size = UDim2.new(0, 160, 0, 150)
MainFrame.Position = UDim2.new(0.5, -80, 0.5, -75)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ClipsDescendants = true
MainFrame.BackgroundTransparency = 0.2

MainFrameCorner.Parent = MainFrame
MainFrameCorner.CornerRadius = UDim.new(0, 10)

MinimizeButton.Parent = MainFrame
MinimizeButton.Size = UDim2.new(0, 160, 0, 20)
MinimizeButton.Position = UDim2.new(0, 0, 0, 0)
MinimizeButton.Text = "▼"
MinimizeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)

MinimizeButtonCorner.Parent = MinimizeButton
MinimizeButtonCorner.CornerRadius = UDim.new(0, 10)

SizeInput.Parent = MainFrame
SizeInput.Size = UDim2.new(0, 140, 0, 25)
SizeInput.Position = UDim2.new(0, 10, 0, 30)
SizeInput.Text = "10"
SizeInput.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
SizeInput.TextColor3 = Color3.fromRGB(255, 255, 255)

SizeInputCorner.Parent = SizeInput
SizeInputCorner.CornerRadius = UDim.new(0, 10)

TransparencyInput.Parent = MainFrame
TransparencyInput.Size = UDim2.new(0, 140, 0, 25)
TransparencyInput.Position = UDim2.new(0, 10, 0, 60)
TransparencyInput.Text = "0.8"
TransparencyInput.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
TransparencyInput.TextColor3 = Color3.fromRGB(255, 255, 255)

TransparencyInputCorner.Parent = TransparencyInput
TransparencyInputCorner.CornerRadius = UDim.new(0, 10)

EnableButton.Parent = MainFrame
EnableButton.Size = UDim2.new(0, 140, 0, 25)
EnableButton.Position = UDim2.new(0, 10, 0, 95)
EnableButton.Text = "Enable Hitbox"
EnableButton.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
EnableButton.TextColor3 = Color3.fromRGB(255, 255, 255)

EnableButtonCorner.Parent = EnableButton
EnableButtonCorner.CornerRadius = UDim.new(0, 10)

-- INPUTS
SizeInput.FocusLost:Connect(function()
	local val = tonumber(SizeInput.Text)
	if val and val > 0 then
		HitboxSize = val
	else
		SizeInput.Text = tostring(HitboxSize)
	end
end)

TransparencyInput.FocusLost:Connect(function()
	local val = tonumber(TransparencyInput.Text)
	if val and val >= 0 and val <= 1 then
		HitboxTransparency = val
	else
		TransparencyInput.Text = tostring(HitboxTransparency)
	end
end)

EnableButton.MouseButton1Click:Connect(function()
	HitboxEnabled = not HitboxEnabled
	EnableButton.Text = HitboxEnabled and "Disable Hitbox" or "Enable Hitbox"
	EnableButton.BackgroundColor3 = HitboxEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(90, 90, 90)
end)

MinimizeButton.MouseButton1Click:Connect(function()
	IsMinimized = not IsMinimized
	
	local TargetSize = IsMinimized and UDim2.new(0, 160, 0, 20) or UDim2.new(0, 160, 0, 150)
	local CollapseTween = TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		Size = TargetSize
	})
	
	CollapseTween:Play()
	MinimizeButton.Text = IsMinimized and "▲" or "▼"
end)

-- SISTEMA PRINCIPAL (UN SOLO LOOP)
RunService.RenderStepped:Connect(function()

	for _, Player in ipairs(Players:GetPlayers()) do
		
		if Player ~= LocalPlayer and Player.Character then
			
			local RootPart = Player.Character:FindFirstChild("HumanoidRootPart")
			local Humanoid = Player.Character:FindFirstChildOfClass("Humanoid")
			
			if RootPart and Humanoid then
				
				if not OriginalData[Player] then
					OriginalData[Player] = {
						Size = RootPart.Size,
						Transparency = RootPart.Transparency
					}
				end
				
				if HitboxEnabled and Humanoid.Health > 0 then
					
					RootPart.Size = Vector3.new(HitboxSize, HitboxSize, HitboxSize)
					RootPart.Transparency = HitboxTransparency
					RootPart.BrickColor = BrickColor.new("Really red")
					RootPart.Material = Enum.Material.Neon
					
				else
					
					if OriginalData[Player] then
						RootPart.Size = OriginalData[Player].Size
						RootPart.Transparency = OriginalData[Player].Transparency
					end
					
				end
				
				-- Forzar sin colisión rápido
				if RootPart.CanCollide then
					RootPart.CanCollide = false
				end
				
			end
		end
		
	end
	
end)
